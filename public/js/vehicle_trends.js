const getSeriesData = () => {
    return [{
            "id": "AGV-1",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 9,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 4,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 7,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 8,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 2,
                }
            ]
        },
        {
            "id": "AGV-2",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 4,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 16,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 12,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 15,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 1,
                }
            ]
        },
        {
            "id": "AGV-3",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 3,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 17,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 10,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 13,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 3,
                }
            ]
        },
        {
            "id": "AGV-4",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 7,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 14,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 4,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 5,
                }
            ]
        },
        {
            "id": "AGV-5",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 6,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 6,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 13,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 10,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 10,
                }
            ]
        },
        {
            "id": "AGV-6",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 6,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 9,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 10,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 9,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 16,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 12,
                }
            ]
        },
        {
            "id": "AGV-7",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 6,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 14,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 14,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 9,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 8,
                }
            ]
        },
        {
            "id": "AGV-8",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 13,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 14,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 9,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 13,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 9,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 15,
                }
            ]
        },
        {
            "id": "AGV-9",
            "values": [{
                    "date": "2020-10-02T00:00:00.000Z",
                    "order": 5,
                },
                {
                    "date": "2020-10-03T00:00:00.000Z",
                    "order": 21,
                },
                {
                    "date": "2020-10-04T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-05T00:00:00.000Z",
                    "order": 11,
                },
                {
                    "date": "2020-10-06T00:00:00.000Z",
                    "order": 12,
                },
                {
                    "date": "2020-10-07T00:00:00.000Z",
                    "order": 19,
                }
            ]
        }
    ]
}

const getData = () => {
    return [{
            "date": "02-Oct-2020",
            "A": "9",
            "B": "4",
            "C": "11",
            "D": "7",
            "E": "6",
            "F": "6",
            "G": "6",
            "H": "13",
            "I": "5"
        },
        {
            "date": "03-Oct-2020",
            "A": "4",
            "B": "16",
            "C": "8",
            "D": "11",
            "E": "11",
            "F": "9",
            "G": "14",
            "H": "14",
            "I": "21"
        },
        {
            "date": "04-Oct-2020",
            "A": "7",
            "B": "11",
            "C": "17",
            "D": "14",
            "E": "6",
            "F": "10",
            "G": "14",
            "H": "9",
            "I": "11"
        },
        {
            "date": "05-Oct-2020",
            "A": "8",
            "B": "12",
            "C": "10",
            "D": "4",
            "E": "13",
            "F": "9",
            "G": "9",
            "H": "13",
            "I": "11"
        },
        {
            "date": "06-Oct-2020",
            "A": "11",
            "B": "15",
            "C": "13",
            "D": "11",
            "E": "10",
            "F": "16",
            "G": "11",
            "H": "9",
            "I": "12"
        },
        {
            "date": "07-Oct-2020",
            "A": "2",
            "B": "1",
            "C": "3",
            "D": "5",
            "E": "3",
            "F": "3",
            "G": "4",
            "H": "3",
            "I": "5"
        }
    ];
}

//------------------------1. PREPARATION------------------------//
//-----------------------------SVG------------------------------//
const width = 960;
const height = 500;
const margin = 5;
const padding = 5;
const adj = 30;
// we are appending SVG first
const svg = d3.select("div#container").append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "-" +
        adj + " -" +
        adj + " " +
        (width + adj * 3) + " " +
        (height + adj * 3))
    .style("padding", padding)
    .style("margin", margin)
    .classed("svg-content", true);

//-----------------------------DATA-----------------------------//
const timeConv = d3.timeParse("%d-%b-%Y");
const data = getData();
var slices = data.map(function(id) {
    return {
        id: id,
        values: data.map(function(d) {
            return {
                date: timeConv(d.date),
                order: +d[id]
            };
        })
    };
});

var slices = getSeriesData();

//----------------------------SCALES----------------------------//
const xScale = d3.scaleTime().range([0, width]);
const yScale = d3.scaleLinear().rangeRound([height, 0]);
xScale.domain(d3.extent(data, function(d) {
    return timeConv(d.date)
}));

yScale.domain([(0), d3.max(slices, function(c) {
    return d3.max(c.values, function(d) {
        return d.order + 4;
    });
})]);

//-----------------------------AXES-----------------------------//
const yaxis = d3.axisLeft()
    .ticks((slices[0].values).length)
    .scale(yScale);

const xaxis = d3.axisBottom()
    .ticks(d3.timeDay.every(1))
    .tickFormat(d3.timeFormat('%b %d'))
    .scale(xScale);

//----------------------------LINES-----------------------------//
const line = d3.line()
    .x(function(d) {
        if (typeof(d.date) === 'string') {
            d.date = new Date(d.date);
        }
        return xScale(d.date);
    })
    .y(function(d) { return yScale(d.order); });

//-------------------------2. DRAWING---------------------------//
//-----------------------------AXES-----------------------------//
svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xaxis);

svg.append("g")
    .attr("class", "axis")
    .call(yaxis)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("dy", ".75em")
    .attr("y", 6)
    .style("text-anchor", "end")
    .text("Frequency");

//----------------------------LINES-----------------------------//
const lines = svg.selectAll("lines")
    .data(slices)
    .enter()
    .append("g");

lines.append("path")
    .attr("class", "line")
    .attr("d", function(d) {
        return line(d.values);
    });

lines.append("text")
    .attr("class", "serie_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]
        };
    })
    .attr("transform", function(d) {
        return "translate(" + (xScale(d.value.date) + 10) +
            "," + (yScale(d.value.order) + 5) + ")";
    })
    .attr("x", -10)
    .text(function(d) {
        return d.id;
    });

const ghost_lines = lines.append("path")
    .attr("class", "ghost-line")
    .attr("d", function(d) {
        return line(d.values);
    });

//---------------------------EVENTS-----------------------------// 
svg.selectAll(".ghost-line")
    .on('mouseover', function() {
        const selection = d3.select(this).raise();

        selection
            .transition()
            .delay("100").duration("10")
            .style("stroke", "#ed3700")
            .style("opacity", "1")
            .style("stroke-width", "3");

        // add the legend action
        const legend = d3.select(this.parentNode)
            .select(".serie_label");

        legend
            .transition()
            .delay("100")
            .duration("10")
            .style("fill", "#2b2929");
    })

.on('mouseout', function() {
    const selection = d3.select(this)

    selection
        .transition()
        .delay("100")
        .duration("10")
        .style("stroke", "#d2d2d2")
        .style("opacity", "0")
        .style("stroke-width", "10");

    // add the legend action
    const legend = d3.select(this.parentNode)
        .select(".serie_label");

    legend
        .transition()
        .delay("100")
        .duration("10")
        .style("fill", "#d2d2d2");
});